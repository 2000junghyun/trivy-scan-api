{
  "SchemaVersion": 2,
  "CreatedAt": "2025-10-19T10:52:40.300546+09:00",
  "ArtifactName": "test/tf/test_03.tf",
  "ArtifactType": "filesystem",
  "Results": [
    {
      "Target": ".",
      "Class": "config",
      "Type": "terraform",
      "MisconfSummary": {
        "Successes": 57,
        "Failures": 0
      }
    },
    {
      "Target": "test_03.tf",
      "Class": "config",
      "Type": "terraform",
      "MisconfSummary": {
        "Successes": 0,
        "Failures": 1
      },
      "Misconfigurations": [
        {
          "Type": "Terraform Security Check",
          "ID": "aws-autoscaling-enforce-http-token-imds",
          "AVDID": "AVD-AWS-0130",
          "Title": "aws_instance should activate session tokens for Instance Metadata Service.",
          "Description": "IMDS v2 (Instance Metadata Service) introduced session authentication tokens which improve security when talking to IMDS.\n\nBy default \u003ccode\u003eaws_instance\u003c/code\u003e resource sets IMDS session auth tokens to be optional.\n\nTo fully protect IMDS you need to enable session tokens by using \u003ccode\u003emetadata_options\u003c/code\u003e block and its \u003ccode\u003ehttp_tokens\u003c/code\u003e variable set to \u003ccode\u003erequired\u003c/code\u003e.\n",
          "Message": "Launch template does not require IMDS access to require a token",
          "Namespace": "builtin.aws.ec2.aws0130",
          "Query": "data.builtin.aws.ec2.aws0130.deny",
          "Resolution": "Enable HTTP token requirement for IMDS",
          "Severity": "HIGH",
          "PrimaryURL": "https://avd.aquasec.com/misconfig/aws-autoscaling-enforce-http-token-imds",
          "References": [
            "https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service",
            "https://avd.aquasec.com/misconfig/aws-autoscaling-enforce-http-token-imds"
          ],
          "Status": "FAIL",
          "CauseMetadata": {
            "Resource": "aws_launch_template.web",
            "Provider": "AWS",
            "Service": "ec2",
            "StartLine": 1,
            "EndLine": 20,
            "Code": {
              "Lines": [
                {
                  "Number": 1,
                  "Content": "resource \"aws_launch_template\" \"web\" {",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "Highlighted": "\u001b[38;5;33mresource\u001b[0m \u001b[38;5;37m\"aws_launch_template\"\u001b[0m \u001b[38;5;37m\"web\"\u001b[0m {",
                  "FirstCause": true,
                  "LastCause": false
                },
                {
                  "Number": 2,
                  "Content": "  name_prefix   = \"${var.project}-web-lt-\"",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "Highlighted": "  \u001b[38;5;245mname_prefix\u001b[0m   = \u001b[38;5;37m\"\u001b[0m\u001b[38;5;37m${\u001b[0m\u001b[38;5;33mvar\u001b[0m.project\u001b[38;5;37m}\u001b[0m\u001b[38;5;37m-web-lt-\"",
                  "FirstCause": false,
                  "LastCause": false
                },
                {
                  "Number": 3,
                  "Content": "  image_id      = var.ami_id",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "Highlighted": "\u001b[0m  \u001b[38;5;245mimage_id\u001b[0m      = \u001b[38;5;33mvar\u001b[0m.ami_id",
                  "FirstCause": false,
                  "LastCause": false
                },
                {
                  "Number": 4,
                  "Content": "  instance_type = var.instance_type",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "Highlighted": "  \u001b[38;5;245minstance_type\u001b[0m = \u001b[38;5;33mvar\u001b[0m.instance_type",
                  "FirstCause": false,
                  "LastCause": false
                },
                {
                  "Number": 5,
                  "Content": "  key_name      = var.key_pair_name",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "Highlighted": "  \u001b[38;5;245mkey_name\u001b[0m      = \u001b[38;5;33mvar\u001b[0m.key_pair_name",
                  "FirstCause": false,
                  "LastCause": false
                },
                {
                  "Number": 6,
                  "Content": "",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "FirstCause": false,
                  "LastCause": false
                },
                {
                  "Number": 7,
                  "Content": "  user_data = base64encode(file(var.user_data_path))",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "Highlighted": "  \u001b[38;5;245muser_data\u001b[0m =\u001b[38;5;33m base64encode\u001b[0m(\u001b[38;5;33mfile\u001b[0m(\u001b[38;5;33mvar\u001b[0m.user_data_path))",
                  "FirstCause": false,
                  "LastCause": false
                },
                {
                  "Number": 8,
                  "Content": "",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "FirstCause": false,
                  "LastCause": false
                },
                {
                  "Number": 9,
                  "Content": "  network_interfaces {",
                  "IsCause": true,
                  "Annotation": "",
                  "Truncated": false,
                  "Highlighted": "  network_interfaces {",
                  "FirstCause": false,
                  "LastCause": true
                },
                {
                  "Number": 10,
                  "Content": "",
                  "IsCause": false,
                  "Annotation": "",
                  "Truncated": true,
                  "FirstCause": false,
                  "LastCause": false
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
